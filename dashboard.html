<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - MicroGuard</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            display: ['Outfit', 'sans-serif'],
          },
          colors: {
            primary: {
              DEFAULT: '#0ea5e9', // Sky 500
              dark: '#0284c7',   // Sky 600
              light: '#38bdf8',  // Sky 400
            },
            secondary: {
              DEFAULT: '#8b5cf6', // Violet 500
              dark: '#7c3aed',   // Violet 600
              light: '#a78bfa',  // Violet 400
            },
            dark: {
              900: '#0f172a',    // Slate 900
              800: '#1e293b',    // Slate 800
              700: '#334155',    // Slate 700
            },
            success: '#22c55e',
            warning: '#eab308',
            danger: '#ef4444',
          }
        }
      }
    }
  </script>
  
  <!-- Custom Styles (Animations) -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-dark-900 text-slate-100 font-sans antialiased selection:bg-primary selection:text-white pt-20">

  <!-- Dashboard Navbar -->
  <nav class="fixed w-full z-40 top-0 start-0 border-b border-white/10 bg-dark-900/80 backdrop-blur-md">
    <div class="max-w-7xl mx-auto flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="index.html" class="flex items-center space-x-3 rtl:space-x-reverse group">
        <span class="text-2xl font-display font-bold bg-gradient-to-r from-primary-light to-secondary-light bg-clip-text text-transparent group-hover:to-primary transition-all duration-300">MicroGuard</span>
      </a>
      <button onclick="dashboardManager.logout()" class="text-slate-300 hover:text-white hover:bg-white/10 font-medium rounded-lg text-sm px-4 py-2 text-center transition-colors flex items-center gap-2">
        <span>Logout</span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
      </button>
    </div>
  </nav>

  <!-- Main Dashboard -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Welcome Section & Actions -->
    <div class="flex flex-col md:flex-row justify-between items-end mb-10 animate-fade-in gap-6">
      <div>
        <h1 class="text-3xl md:text-4xl font-display font-bold bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent mb-2">Welcome Back!</h1>
        <p class="text-slate-400">Monitor your health and environmental safety in real-time.</p>
      </div>

      <!-- Compact Actions -->
      <div class="flex gap-4">
        <button onclick="detectionManager.startBloodDetection()" class="flex items-center gap-3 px-6 py-3 bg-dark-800 hover:bg-red-500/10 border border-white/10 hover:border-red-500/50 rounded-xl transition-all group shadow-lg hover:shadow-red-500/10">
           <span class="text-2xl group-hover:scale-110 transition-transform">ðŸ©¸</span>
           <div class="text-left">
             <div class="text-sm font-bold text-white group-hover:text-red-400 transition-colors">Blood Test</div>
             <div class="text-xs text-slate-500">New Detection</div>
           </div>
        </button>
        
         <button onclick="detectionManager.startWaterDetection()" class="flex items-center gap-3 px-6 py-3 bg-dark-800 hover:bg-blue-500/10 border border-white/10 hover:border-blue-500/50 rounded-xl transition-all group shadow-lg hover:shadow-blue-500/10">
           <span class="text-2xl group-hover:scale-110 transition-transform">ðŸ’§</span>
           <div class="text-left">
             <div class="text-sm font-bold text-white group-hover:text-blue-400 transition-colors">Water Test</div>
             <div class="text-xs text-slate-500">New Detection</div>
           </div>
        </button>
      </div>
    </div>

    <!-- User Profile -->
    <div class="bg-dark-800/50 border border-white/10 rounded-3xl p-6 md:p-8 backdrop-blur-sm mb-10 shadow-lg animate-slide-up">
      <div class="flex items-center gap-3 mb-6">
        <div class="p-2 bg-primary/10 rounded-lg text-primary">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
        </div>
        <h3 class="text-xl font-bold text-white">Your Profile</h3>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="p-4 bg-dark-900/50 rounded-2xl border border-white/5 hover:border-white/10 transition-colors">
          <div class="text-xs font-medium text-slate-500 uppercase tracking-wider mb-1">Name</div>
          <div id="userName" class="text-lg font-semibold text-slate-200">Loading...</div>
        </div>
        
        <div class="p-4 bg-dark-900/50 rounded-2xl border border-white/5 hover:border-white/10 transition-colors">
          <div class="text-xs font-medium text-slate-500 uppercase tracking-wider mb-1">Email</div>
          <div id="userEmail" class="text-lg font-semibold text-slate-200 truncate">Loading...</div>
        </div>
        
        <div class="p-4 bg-dark-900/50 rounded-2xl border border-white/5 hover:border-white/10 transition-colors">
          <div class="text-xs font-medium text-slate-500 uppercase tracking-wider mb-1">Mobile</div>
          <div id="userMobile" class="text-lg font-semibold text-slate-200">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Status Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      <!-- Blood Status -->
      <div class="relative group bg-dark-800/50 border border-white/10 rounded-3xl p-6 shadow-lg overflow-hidden animate-slide-up" style="animation-delay: 0.1s;">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 to-red-600"></div>
        <div class="flex justify-between items-start mb-1">
          <h4 class="text-lg font-bold text-slate-200 flex items-center gap-2">
            <span class="text-red-500 text-xl">ðŸ©¸</span> Blood Status
          </h4>
        </div>
        <div id="bloodDate" class="text-xs text-slate-500 font-medium mb-4 pl-8"></div>
        <div class="flex items-end justify-between">
          <div id="bloodStatus" class="text-4xl font-bold text-white">--</div>
          <span id="bloodRisk" class="px-3 py-1 bg-slate-700/50 text-slate-300 text-xs font-bold rounded-full border border-white/10">NO DATA</span>
        </div>
      </div>

      <!-- Water Status -->
      <div class="relative group bg-dark-800/50 border border-white/10 rounded-3xl p-6 shadow-lg overflow-hidden animate-slide-up" style="animation-delay: 0.2s;">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-cyan-500"></div>
        <div class="flex justify-between items-start mb-1">
          <h4 class="text-lg font-bold text-slate-200 flex items-center gap-2">
            <span class="text-blue-500 text-xl">ðŸ’§</span> Water Status
          </h4>
        </div>
        <div id="waterDate" class="text-xs text-slate-500 font-medium mb-4 pl-8"></div>
        <div class="flex items-end justify-between">
          <div id="waterStatus" class="text-4xl font-bold text-white">--</div>
          <span id="waterRisk" class="px-3 py-1 bg-slate-700/50 text-slate-300 text-xs font-bold rounded-full border border-white/10">NO DATA</span>
        </div>
      </div>

      <!-- Next Test -->
      <div class="relative group bg-dark-800/50 border border-white/10 rounded-3xl p-6 shadow-lg overflow-hidden animate-slide-up" style="animation-delay: 0.3s;">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-secondary to-secondary-light"></div>
        <div class="flex justify-between items-start mb-4">
          <h4 class="text-lg font-bold text-slate-200 flex items-center gap-2">
            <span class="text-secondary text-xl">ðŸ“…</span> Next Test
          </h4>
        </div>
        <div class="mt-2">
          <div id="nextTestDate" class="text-xl font-semibold text-slate-200">Loading...</div>
          <p class="text-sm text-slate-500 mt-1">Recommended Schedule</p>
        </div>
      </div>
    </div>



    <!-- Detection History Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
      <!-- Blood Chart -->
      <div class="bg-dark-800/50 border border-white/10 rounded-3xl p-6 shadow-lg backdrop-blur-sm animate-slide-up" style="animation-delay: 0.45s;">
        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <span class="text-red-500 text-xl">ðŸ©¸</span> Blood Microplastic History
        </h3>
        <div class="relative h-64 w-full">
          <canvas id="bloodChart"></canvas>
        </div>
      </div>

      <!-- Water Chart -->
      <div class="bg-dark-800/50 border border-white/10 rounded-3xl p-6 shadow-lg backdrop-blur-sm animate-slide-up" style="animation-delay: 0.5s;">
        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <span class="text-blue-500 text-xl">ðŸ’§</span> Water Microplastic History
        </h3>
        <div class="relative h-64 w-full">
          <canvas id="waterChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Detection History -->
    <div class="bg-dark-800/50 border border-white/10 rounded-3xl p-6 md:p-8 backdrop-blur-sm animate-slide-up" style="animation-delay: 0.5s;">
      <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        Detection History
      </h3>
      <div id="historyContainer" class="space-y-4">
        <!-- History listing will be injected here -->
        <div class="text-center py-12 text-slate-500 bg-dark-900/30 rounded-2xl border border-white/5 border-dashed">
          <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="2"></circle><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6l4 2"></path></svg>
          Loading history...
        </div>
      </div>
    </div>
  </div>

  <!-- Detection Modal -->
  <div id="detectionModal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 invisible transition-all duration-300">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm modal-backdrop" onclick="detectionManager.closeDetectionModal()"></div>
    
    <div class="relative bg-dark-800 border border-white/10 rounded-3xl p-8 w-full max-w-2xl shadow-2xl scale-95 transition-all duration-300 max-h-[90vh] overflow-y-auto" id="detectionContent">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold font-display flex items-center gap-3">
          <span id="detectionIcon" class="text-3xl">ðŸ”¬</span>
          <span id="detectionTitle" class="text-white">Detection</span>
        </h2>
        <button onclick="detectionManager.closeDetectionModal()" class="text-slate-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 p-2 rounded-lg">
          <svg class="w-5 h-5" fill="none" class="w-6 h-6" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      </div>

      <div class="modal-body">
        <!-- Scanning View -->
        <div id="scanningView" class="flex flex-col items-center py-8">
          <div class="relative w-64 h-64 rounded-full bg-dark-900 border-4 border-dark-700 shadow-[inset_0_0_40px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden mb-8 group">
             <!-- Scanning line animation -->
             <div class="absolute inset-x-0 h-1 bg-primary/50 shadow-[0_0_20px_#0ea5e9] scanning-line z-20 w-full"></div>
             
             <!-- Radar Sweep -->
             <div class="absolute inset-0 rounded-full radar-sweep z-10 w-full h-full"></div>

             <!-- Pulse Ring -->
             <div class="absolute inset-0 rounded-full border-2 border-primary/30 pulse-ring z-0"></div>
             
             <!-- Grid background -->
             <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4xKSIvPjwvc3ZnPg==')] opacity-30 z-0"></div>
             
             <div class="text-5xl font-bold font-display text-primary animate-pulse relative z-30" id="detectionValue">0%</div>
          </div>
          
          <h4 id="scanningStatus" class="text-xl font-semibold text-white mb-2 animate-pulse">
            Scanning in progress...
          </h4>
          <div id="scanningRisk" class="text-lg font-bold mb-2 h-6"></div>
          <p class="text-slate-400 text-sm">Receiving real-time data from IoT sensor</p>
        </div>

        <!-- Results View -->
        <div id="resultsView" class="hidden animate-fade-in">
          <div class="text-center mb-10 p-8 bg-dark-900/50 rounded-3xl border border-white/5">
            <div class="text-6xl font-display font-bold text-white mb-4" id="resultValue">0%</div>
            <span id="resultRiskLevel" class="inline-block px-4 py-1.5 rounded-full text-sm font-bold tracking-wider uppercase bg-slate-700 text-slate-300">ANALYZING</span>
          </div>

          <div class="space-y-8">
            <div class="p-6 bg-dark-900/30 rounded-2xl border border-white/5">
              <h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                 <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                 Summary
              </h4>
              <p class="text-slate-400 leading-relaxed" id="resultSummary"></p>
            </div>

            <div class="p-6 bg-dark-900/30 rounded-2xl border border-white/5">
              <h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
                Health Impact
              </h4>
              <p class="text-slate-400 leading-relaxed" id="resultHealthImpact"></p>
            </div>

            <div class="p-6 bg-dark-900/30 rounded-2xl border border-white/5">
              <h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                Recommended Actions
              </h4>
              <ul class="text-slate-400 space-y-2 list-disc pl-5" id="resultRemedies"></ul>
            </div>
          </div>

          <div class="mt-8 p-4 bg-primary/10 rounded-xl border border-primary/20 flex items-center justify-between">
            <span class="text-sm font-medium text-primary-light">Next Recommended Test</span>
            <span class="text-lg font-bold text-white" id="resultNextTest"></span>
          </div>

          <button class="w-full mt-8 bg-primary hover:bg-primary-dark text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 transition-all hover:scale-[1.02] active:scale-[0.98]" onclick="detectionManager.closeDetectionModal(); location.reload();">
            Done
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div id="detailsModal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 invisible transition-all duration-300">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm modal-backdrop" onclick="document.getElementById('detailsModal').classList.add('invisible', 'opacity-0')"></div>
    
    <div class="relative bg-dark-800 border border-white/10 rounded-3xl p-8 w-full max-w-2xl shadow-2xl scale-95 transition-all duration-300 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-8 pb-4 border-b border-white/5">
        <div>
           <h2 class="text-2xl font-bold font-display flex items-center gap-3 mb-1">
            <span id="detailsIcon" class="text-3xl">ðŸ”¬</span>
            <span id="detailsType" class="text-white">Detection Details</span>
          </h2>
          <div id="detailsDate" class="text-slate-400 text-sm ml-11"></div>
        </div>
        <button onclick="document.getElementById('detailsModal').classList.add('invisible', 'opacity-0')" class="text-slate-400 hover:text-white transition-colors bg-white/5 hover:bg-white/10 p-2 rounded-lg">
          <svg class="w-5 h-5" fill="none" class="w-6 h-6" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      </div>
      
      <div class="space-y-8">
         <div class="text-center p-6 bg-dark-900/50 rounded-2xl border border-white/5">
            <div class="text-5xl font-display font-bold text-white mb-3" id="detailsValue">0%</div>
            <span id="detailsRisk" class="inline-block px-4 py-1.5 rounded-full text-sm font-bold tracking-wider uppercase bg-slate-700 text-slate-300">RISK LEVEL</span>
         </div>

         <div class="p-6 bg-dark-900/30 rounded-2xl border border-white/5">
           <h4 class="text-lg font-bold text-white mb-2">Summary</h4>
           <p class="text-slate-400 leading-relaxed" id="detailsSummary"></p>
         </div>

         <div class="p-6 bg-dark-900/30 rounded-2xl border border-white/5">
           <h4 class="text-lg font-bold text-white mb-2">Health Impact</h4>
           <p class="text-slate-400 leading-relaxed" id="detailsImpact"></p>
         </div>

         <div class="p-6 bg-dark-900/30 rounded-2xl border border-white/5">
           <h4 class="text-lg font-bold text-white mb-2">Recommended Actions</h4>
           <ul class="text-slate-400 space-y-2 list-disc pl-5" id="detailsRemedies"></ul>
         </div>
         
         <div class="p-4 bg-primary/10 rounded-xl border border-primary/20 flex items-center justify-between">
            <span class="text-sm font-medium text-primary-light">Next Recommended Test</span>
            <span class="text-lg font-bold text-white" id="detailsNextTest"></span>
          </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <!-- jsPDF Library for Certificate Generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- Application Scripts -->
  <script src="js/config.js"></script>
  <script src="js/firebase-init.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/detection.js"></script>
  <script src="js/certificate.js"></script>
  
  <script>
    // Initialize application
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialize Firebase
      initializeFirebase();
      
      // Initialize Auth
      authManager.init();
      
      // Initialize Certificate Generator
      certificateGenerator.init();
      
      // Wait for auth state
      setTimeout(async () => {
        // Initialize Detection Manager
        detectionManager.init();
        
        // Initialize Dashboard
        await dashboardManager.init();
      }, 1000);
    });

    // Close modals on backdrop click - Updated for Tailwind logic
    document.getElementById('detectionModal').addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-backdrop')) {
        detectionManager.closeDetectionModal();
      }
    });
  </script>
</body>
</html>
